<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AresNyX - Premium Boxer Shorts Shop</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <style>
    /* ===== CRITICAL CSS - OPTIMIZOVANO ===== */
    :root {
        --primary-dark: #121212;
        --accent-gold: #D4AF37;
        --accent-hover: #F4C44D;
        --success: #27AE60;
        --danger: #E74C3C;
        --gray-light: #F8F9FA;
        --gray-medium: #E9ECEF;
        --text-dark: #2C3E50;
        --shadow: 0 10px 30px rgba(0,0,0,0.1);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
        font-family: 'Montserrat', system-ui, -apple-system, sans-serif;
        background: #fff; color: var(--text-dark); line-height: 1.6;
        display: flex; flex-direction: column; min-height: 100vh;
    }
    
    body.no-scroll { overflow: hidden; }

    /* HEADER */
    .header { 
        background: var(--primary-dark); padding: 1rem 2rem; 
        position: sticky; top: 0; z-index: 1000; 
        box-shadow: 0 2px 20px rgba(0,0,0,0.3);
    }
    .navbar { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; }
    .logo { font-size: 2rem; font-weight: 700; color: var(--accent-gold); text-decoration: none; letter-spacing: 3px; }
    .cart-icon { position: relative; cursor: pointer; padding: 0.5rem 1rem; color: #fff; font-size: 1.1rem; transition: var(--transition); }
    .cart-count { position: absolute; top: -8px; right: -8px; background: var(--danger); color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.8em; font-weight: 600; }
    
    /* PRODUCTS GRID */
    .products-section { padding: 3rem 2rem; max-width: 1400px; margin: 0 auto; flex: 1; }
    .products-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
    .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: var(--shadow); cursor: pointer; transition: var(--transition); }
    .product-image { width: 100%; height: 200px; object-fit: cover; background: #f7f7f7; }
    .product-info { padding: 1.2rem; }
    
    @media (min-width: 576px) { .products-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 992px) { .products-grid { grid-template-columns: repeat(3, 1fr); } }
    
    /* FOOTER */
    .footer { background: var(--primary-dark); color: white; padding: 3rem 2rem 2rem; margin-top: auto; }

    /* MODAL */
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0,0,0,0.9); z-index: 2000; backdrop-filter: blur(5px); }
    .modal-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 16px; width: 90%; max-width: 700px; max-height: 95vh; overflow-y: auto; }
    .modal-close { position: absolute; top: 1rem; right: 1rem; background: rgba(0,0,0,0.5); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; z-index: 10; transition: all 0.3s; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }
    .modal-content { padding: 1.5rem; }
    
    /* KORPA */
    .cart-sidebar { 
        position: fixed; top: 0; right: -400px; width: 400px; 
        height: 100vh; background: white; box-shadow: -5px 0 25px rgba(0,0,0,0.1); 
        transition: all 0.3s; z-index: 1500; display: flex; flex-direction: column; 
    }
    @media (max-width: 450px) { .cart-sidebar { width: 100%; right: -100%; } }
    .cart-sidebar.active { right: 0; }
    .cart-header { padding: 1.5rem; border-bottom: 1px solid var(--gray-medium); display: flex; justify-content: space-between; align-items: center; background: var(--primary-dark); color: white; position: sticky; top: 0; z-index: 10; }
    
    .cart-items { flex: 1; overflow-y: auto; padding: 1rem; }
    .cart-item { display: flex; padding: 0.8rem 0; border-bottom: 1px solid var(--gray-medium); align-items: flex-start; position: relative; }
    .cart-item-image { width: 70px; height: 70px; object-fit: cover; border-radius: 8px; margin-right: 1rem; flex-shrink: 0; }
    .cart-item-details { flex-grow: 1; display: flex; flex-direction: column; padding-right: 35px; }
    .cart-item-title { font-weight: 600; margin-bottom: 0.2rem; font-size: 0.95rem; line-height: 1.2; }
    .cart-item-size { margin-bottom: 0; font-size: 0.9rem; color: var(--primary-dark); font-weight: 500; }
    .cart-item-controls { display: flex; align-items: center; justify-content: space-between; width: 100%; margin-top: 0.5rem; }
    .cart-item-qty-wrapper { display: flex; align-items: center; gap: 0.8rem; }
    .cart-item-qty-btn { width: 30px; height: 30px; border: 1px solid var(--gray-medium); background: white; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }
    .cart-item-qty { padding: 0.3rem 0.6rem; background: var(--gray-light); border-radius: 4px; font-weight: 600; min-width: 30px; text-align: center; flex-shrink: 0; }
    .cart-item-price { font-weight: 700; color: var(--primary-dark); font-size: 1rem; flex-shrink: 0; }
    .cart-item-remove { position: absolute; top: 0.8rem; right: 0; background: var(--danger); color: white; border: none; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
    
    /* Footer Korpe i Dugmad */
    .cart-footer { padding: 1.5rem; border-top: 1px solid var(--gray-medium); background: var(--gray-light); position: sticky; bottom: 0; z-index: 10; }
    .cart-actions-footer { margin-bottom: 1rem; }
    .clear-cart-btn { 
        width: 100%; background: var(--danger); color: white; 
        border: none; padding: 1rem; border-radius: 8px; /* Povećan padding */
        cursor: pointer; transition: var(--transition); 
        font-weight: 600; font-size: 1.1rem; /* Povećana slova */
        display: flex; align-items: center; justify-content: center; gap: 0.5rem; 
        margin-bottom: 1rem;
    }
    
    .checkout-btn { 
        width: 100%; 
        background: var(--primary-dark); /* Crna pozadina */
        color: white; 
        border: none; 
        padding: 1rem; /* Ista veličina kao Isprazni Korpu */
        border-radius: 8px; 
        font-size: 1.1rem; /* Krupna slova */
        font-weight: 600; 
        cursor: pointer; 
        transition: var(--transition); 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        gap: 0.5rem; 
        margin-top: 1rem; /* Razmak iznad */
    }
    .checkout-btn:hover { background: #333; }
    
    .cart-total-row.final { font-weight: 700; font-size: 1.2rem; border-top: 2px solid var(--primary-dark); padding-top: 0.8rem; margin-top: 0.5rem; }

    /* Media Query za uklanjanje slike na mobilnom - već urađeno u V4 */
    @media (max-width: 576px) { 
        .cart-item-image { display: none; }
    }
    
    /* ===== CHECKOUT MODAL STYLES ===== */
    #checkoutModal .modal-container {
        max-width: 500px; /* Manja širina za formu */
        padding: 2rem;
    }
    .checkout-form h2 {
        color: var(--primary-dark);
        margin-bottom: 1.5rem;
    }
    .form-group {
        margin-bottom: 1.2rem;
    }
    .form-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.4rem;
        font-size: 0.95rem;
    }
    .form-group input, .form-group select, .form-group textarea {
        width: 100%;
        padding: 0.8rem;
        border: 1px solid var(--gray-medium);
        border-radius: 6px;
        font-size: 1rem;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        transition: border-color 0.3s;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
        border-color: var(--accent-gold);
        outline: none;
        box-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
    }
    .form-group textarea {
        resize: vertical;
        min-height: 80px;
    }
    
    .submit-btn {
        width: 100%; 
        background: var(--success); 
        color: white; 
        border: none; 
        padding: 1rem; 
        border-radius: 8px; 
        font-size: 1.1rem; 
        font-weight: 700; 
        cursor: pointer; 
        transition: var(--transition);
        margin-top: 1.5rem;
    }

    /* Korak 2: Pregled Porudžbine (Preview) */
    .preview-container {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
    }
    .preview-shipping, .preview-order {
        padding: 1.5rem;
        border-radius: 8px;
        background: var(--gray-light);
    }
    .preview-shipping {
        flex: 1 1 45%; /* Leva kolona (45% širine) */
    }
    .preview-order {
        flex: 1 1 45%; /* Desna kolona (45% širine) */
    }
    .preview-order h3 { margin-top: 0; color: var(--primary-dark); border-bottom: 1px solid var(--gray-medium); padding-bottom: 0.5rem; }
    .preview-item { font-size: 0.9rem; margin-bottom: 0.5rem; line-height: 1.4; }
    .preview-item strong { display: inline-block; min-width: 80px; }
    .preview-actions { display: flex; gap: 1rem; margin-top: 2rem; }
    .preview-actions button { flex: 1; padding: 1rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: var(--transition); }
    .submit-order-btn { background: var(--success); color: white; border: none; }
    .edit-data-btn { background: white; color: var(--primary-dark); border: 2px solid var(--primary-dark); }
    
    @media (max-width: 600px) {
        .preview-shipping, .preview-order {
            flex-basis: 100%; /* Prikaz u jednoj koloni na mobilnom */
        }
    }
    
    </style>
    
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    </noscript>
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <a href="index.html" class="logo">ARESNYX</a>
            <div class="cart-icon" onclick="shop.toggleCart()">
                <i class="fas fa-shopping-bag"></i>
                <span class="cart-count" id="cartCount">0</span>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <section class="products-section">
            <div class="products-grid" id="productsGrid">
                </div>
        </section>
    </main>

    <footer class="footer">
        </footer>

    <div class="modal-overlay" id="productModal">
        </div>

    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>Vaša Korpa</h3>
            <button class="modal-close" onclick="shop.toggleCart()">×</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="empty-cart" id="emptyCart">
                <i class="fas fa-shopping-bag"></i>
                <p>Vaša korpa je prazna</p>
            </div>
        </div>
        
        <div class="cart-footer" id="cartFooter" style="display: none;">
            
            <div class="cart-actions-footer">
                <button class="clear-cart-btn" onclick="shop.clearCart()">
                    <i class="fas fa-trash"></i> Isprazni Korpu
                </button>
            </div>

            <div class="cart-totals">
                <div class="cart-total-row"><span>Međuzbir:</span><span id="cartSubtotal">0 RSD</span></div>
                <div class="cart-total-row"><span>Poštarina:</span><span id="cartShipping">0 RSD</span></div>
                <div class="cart-total-row"><span>Popust:</span><span id="cartDiscount">0 RSD</span></div>
                <div class="cart-total-row final"><span>Ukupno:</span><span id="cartTotal">0 RSD</span></div>
            </div>
            <button class="checkout-btn" onclick="shop.startCheckout()"><i class="fas fa-truck"></i> Završi Kupovinu</button>
        </div>
    </div>
    
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal-container">
            <button class="modal-close" onclick="shop.closeCheckoutModal()">×</button>
            <div class="modal-content" id="checkoutModalContent">
                
                <div id="checkoutStep1">
                    <form class="checkout-form" onsubmit="shop.submitShippingForm(event)">
                        <h2>Podaci za isporuku</h2>
                        
                        <div class="form-group"><label for="ime">Ime*</label><input type="text" id="ime" required></div>
                        <div class="form-group"><label for="prezime">Prezime*</label><input type="text" id="prezime" required></div>
                        <div class="form-group"><label for="email">Email*</label><input type="email" id="email" required></div>
                        
                        <div class="form-group"><label for="ulica">Ulica i broj*</label><input type="text" id="ulica" required></div>
                        
                        <div class="form-group"><label for="postanskiBroj">Poštanski broj*</label><input type="text" id="postanskiBroj" required></div>
                        <div class="form-group"><label for="grad">Grad*</label><input type="text" id="grad" required></div>
                        <div class="form-group"><label for="opstina">Opština</label><input type="text" id="opstina"></div>

                        <div class="form-group">
                            <label for="placanje">Način plaćanja*</label>
                            <select id="placanje" required>
                                <option value="pouzecem" selected>Pouzećem (Plaćanje prilikom preuzimanja)</option>
                                <option value="racun">Uplata na račun (E-banking)</option>
                                <option value="licno">Lično preuzimanje (dogovor)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="napomena">Napomena za porudžbinu</label>
                            <textarea id="napomena" placeholder="Npr. Vremenska ograničenja za isporuku, dodatne informacije..."></textarea>
                        </div>
                        
                        <button type="submit" class="submit-btn"><i class="fas fa-arrow-right"></i> Pregled i Potvrda Porudžbine</button>
                    </form>
                </div>
                
                <div id="checkoutStep2" style="display: none;">
                    <h2>Pregled Porudžbine</h2>
                    <div class="preview-container">
                        <div class="preview-shipping">
                            <h3>Podaci za isporuku</h3>
                            <p id="previewIme"></p>
                            <p id="previewEmail"></p>
                            <p id="previewAdresa"></p>
                            <p id="previewPostaGrad"></p>
                            <p id="previewPlacanje"></p>
                            <p id="previewNapomena"></p>
                        </div>
                        <div class="preview-order">
                            <h3>Struktura poručene robe</h3>
                            <div id="previewOrderItems"></div>
                            <div class="cart-totals">
                                <div class="cart-total-row"><span>Međuzbir:</span><span id="previewSubtotal"></span></div>
                                <div class="cart-total-row"><span>Poštarina:</span><span id="previewShipping"></span></div>
                                <div class="cart-total-row"><span>Popust:</span><span id="previewDiscount"></span></div>
                                <div class="cart-total-row final"><span>Ukupno:</span><span id="previewTotal"></span></div>
                            </div>
                        </div>
                    </div>
                    <div class="preview-actions">
                        <button class="edit-data-btn" onclick="shop.goToStep(1)"><i class="fas fa-edit"></i> Izmeni Podatke</button>
                        <button class="submit-order-btn" onclick="shop.completeOrder()"><i class="fas fa-paper-plane"></i> Pošalji Porudžbinu</button>
                    </div>
                </div>

                <div id="checkoutStep3" style="display: none;">
                    <div class="success-message">
                        <h2><i class="fas fa-check-circle"></i> Hvala na poverenju!</h2>
                        <p>Vaša porudžbina je uspešno primljena i biće obrađena u najkraćem mogućem roku.</p>
                        <p>Detalji su poslati na Vašu email adresu: <strong id="confirmationEmail"></strong></p>
                        <p>Uskoro ćete biti kontaktirani radi potvrde porudžbine.</p>
                        <button class="submit-btn" onclick="shop.closeCheckoutModal()">Nastavite sa kupovinom</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
    // ===== FIKSIRANA TRENUTNA REAKCIJA KORPE I MOBILNI PRIKAZ =====
    class AresNyXShop {
        constructor() {
            this.cart = JSON.parse(localStorage.getItem('cart')) || [];
            this.products = [
                // Podaci o proizvodima
                { id: 1, name: "Classic Pamuk", material: "100% Organski Pamuk", price: 1300, category: "pamuk", images: ["images/pamuk-1.jpg", "images/pamuk-2.jpg"], badge: "BESTSELLER" },
                { id: 2, name: "Premium Lan", material: "100% Premium Lan", price: 1500, category: "lan", images: ["images/lan-1.jpg", "images/lan-2.jpg"], badge: "PREMIUM" },
                { id: 3, name: "Elegant Svila", material: "100% Prirodna Svila", price: 1800, category: "svila", images: ["images/svila-1.jpg", "images/svila-2.jpg"], badge: "LUXURY" },
                { id: 4, name: "Night Black", material: "100% Premium Pamuk", price: 1300, category: "pamuk", images: ["images/crna-1.jpg", "images/crna-2.jpg"], badge: "POPULAR" },
                { id: 5, name: "Pure White", material: "100% Organski Pamuk", price: 1300, category: "pamuk", images: ["images/bela-1.jpg", "images/bela-2.jpg"], badge: "CLASSIC" },
                { id: 6, name: "Navy Stripes", material: "100% Premium Pamuk", price: 1400, category: "pamuk", images: ["images/navy-1.jpg", "images/navy-2.jpg"], badge: "TRENDING" },
                { id: 7, name: "Dark Grey", material: "100% Premium Pamuk", price: 1300, category: "pamuk", images: ["images/siva-1.jpg", "images/siva-2.jpg"], badge: "ESSENTIAL" },
                { id: 8, name: "Blue Stripes", material: "100% Premium Pamuk", price: 1400, category: "pamuk", images: ["images/plava-1.jpg", "images/plava-2.jpg"], badge: "NEW" },
                { id: 9, name: "Charcoal Black", material: "100% Premium Pamuk", price: 1350, category: "pamuk", images: ["images/charcoal-1.jpg", "images/charcoal-2.jpg"], badge: "PREMIUM" },
                { id: 10, name: "Bamboo Blend", material: "70% Bambus, 30% Pamuk", price: 1600, category: "lan", images: ["images/bambus-1.jpg", "images/bambus-2.jpg"], badge: "ECO" },
                { id: 11, name: "Sport Grey", material: "95% Pamuk, 5% Elastan", price: 1450, category: "pamuk", images: ["images/sport-1.jpg", "images/sport-2.jpg"], badge: "SPORT" },
                { id: 12, name: "Midnight Blue", material: "100% Premium Pamuk", price: 1400, category: "pamuk", images: ["images/midnight-1.jpg", "images/midnight-2.jpg"], badge: "EXCLUSIVE" }
            ];
            this.checkoutData = {};
            this.init();
        }

        init() {
            this.renderProducts();
            this.updateCartCount();
            this.renderCart();
        }
        
        // ... (Ostale metode - loadProducts, renderProducts, openProductModal, addToCart, itd. - nepromenjene u funkcionalnosti) ...
        // Radi uštede prostora u ovom odgovoru, ostavljam samo novu logiku.

        renderProducts() {
            // Skraćeno: Renderovanje proizvoda ostaje nepromenjeno.
        }

        updateCartCount() {
            const totalItems = this.cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCount = document.getElementById('cartCount');
            cartCount.textContent = totalItems;
            cartCount.classList.remove('quick-pulse'); 
            void cartCount.offsetWidth;
            cartCount.classList.add('quick-pulse');
        }

        renderCart() {
            const cartItemsContainer = document.getElementById('cartItems');
            const cartFooter = document.getElementById('cartFooter');
            const emptyCart = document.getElementById('emptyCart');

            if (this.cart.length === 0) {
                emptyCart.style.display = 'block';
                cartFooter.style.display = 'none';
                cartItemsContainer.querySelectorAll('.cart-item').forEach(e => e.remove());
                return;
            }

            emptyCart.style.display = 'none';
            cartFooter.style.display = 'block';

            cartItemsContainer.querySelectorAll('.cart-item').forEach(e => e.remove());

            this.cart.forEach((item, index) => {
                const itemHtml = `
                    <div class="cart-item" data-index="${index}">
                        <button class="cart-item-remove" onclick="shop.removeCartItem(${index})" title="Ukloni proizvod">×</button>
                        <img src="${item.image}" alt="${item.name} veličine ${item.size}" class="cart-item-image" loading="lazy">
                        <div class="cart-item-details">
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-size">Veličina: ${item.size}</div>
                            <div class="cart-item-controls">
                                <div class="cart-item-qty-wrapper">
                                    <button class="cart-item-qty-btn" onclick="shop.updateCartItem(${index}, -1)">-</button>
                                    <span class="cart-item-qty">${item.quantity}</span>
                                    <button class="cart-item-qty-btn" onclick="shop.updateCartItem(${index}, 1)">+</button>
                                </div>
                                <span class="cart-item-price">${item.price * item.quantity} RSD</span>
                            </div>
                        </div>
                    </div>
                `;
                cartItemsContainer.insertAdjacentHTML('beforeend', itemHtml);
            });

            this.updateCartTotals();
        }
        
        // ... (updateCartItem, removeCartItem, clearCart metode - nepromenjene) ...

        updateCartTotals(preview = false) {
            const subtotal = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const totalItems = this.cart.reduce((sum, item) => sum + item.quantity, 0);
            const shipping = totalItems >= 5 ? 0 : (totalItems > 0 ? 400 : 0);
            const discount = totalItems >= 7 ? Math.round(subtotal * 0.1) : 0;
            const total = subtotal + shipping - discount;
            
            if (preview) {
                // Ažuriraj elemente u pregledu porudžbine
                document.getElementById('previewSubtotal').textContent = subtotal + ' RSD';
                document.getElementById('previewShipping').textContent = shipping + ' RSD';
                document.getElementById('previewDiscount').textContent = discount + ' RSD';
                document.getElementById('previewTotal').textContent = total + ' RSD';
            } else {
                // Ažuriraj elemente u Sidebar-u korpe
                document.getElementById('cartSubtotal').textContent = subtotal + ' RSD';
                document.getElementById('cartShipping').textContent = shipping + ' RSD';
                document.getElementById('cartDiscount').textContent = discount + ' RSD';
                
                const totalElement = document.getElementById('cartTotal');
                totalElement.textContent = total + ' RSD';

                totalElement.classList.remove('quick-pulse'); 
                void totalElement.offsetWidth; 
                totalElement.classList.add('quick-pulse');
            }
        }
        
        // =========================================================
        // === NOVI CHECKOUT METODE ===
        // =========================================================

        startCheckout() {
            if (this.cart.length === 0) {
                this.showToast("Korpa je prazna! Dodajte proizvode pre završetka kupovine.");
                return;
            }
            // Zatvori Sidebar korpe
            document.getElementById('cartSidebar').classList.remove('active');
            
            // Otvori Checkout Modal i idi na Korak 1
            document.getElementById('checkoutModal').style.display = 'block';
            document.body.classList.add('no-scroll');
            this.goToStep(1);
        }

        closeCheckoutModal() {
            document.getElementById('checkoutModal').style.display = 'none';
            document.body.classList.remove('no-scroll');
        }

        goToStep(step) {
            document.getElementById('checkoutStep1').style.display = 'none';
            document.getElementById('checkoutStep2').style.display = 'none';
            document.getElementById('checkoutStep3').style.display = 'none';
            
            document.getElementById(`checkoutStep${step}`).style.display = 'block';
        }

        submitShippingForm(event) {
            event.preventDefault();
            
            // 1. Prikupljanje podataka
            this.checkoutData = {
                ime: document.getElementById('ime').value,
                prezime: document.getElementById('prezime').value,
                email: document.getElementById('email').value,
                ulica: document.getElementById('ulica').value,
                postanskiBroj: document.getElementById('postanskiBroj').value,
                grad: document.getElementById('grad').value,
                opstina: document.getElementById('opstina').value,
                placanje: document.getElementById('placanje').value,
                napomena: document.getElementById('napomena').value,
            };
            
            // 2. Renderovanje Pregleda (Korak 2)
            this.renderCheckoutPreview();
            
            // 3. Prelazak na Korak 2
            this.goToStep(2);
        }
        
        getPaymentMethodText(value) {
            switch(value) {
                case 'pouzecem': return 'Pouzećem (Plaćanje prilikom preuzimanja)';
                case 'racun': return 'Uplata na račun (E-banking)';
                case 'licno': return 'Lično preuzimanje (dogovor)';
                default: return value;
            }
        }

        renderCheckoutPreview() {
            const data = this.checkoutData;
            
            // Podaci za Isporuku (Leva strana)
            document.getElementById('previewIme').innerHTML = `<strong>Kupac:</strong> ${data.ime} ${data.prezime}`;
            document.getElementById('previewEmail').innerHTML = `<strong>Email:</strong> ${data.email}`;
            document.getElementById('previewAdresa').innerHTML = `<strong>Adresa:</strong> ${data.ulica} ${data.opstina ? `, ${data.opstina}` : ''}`;
            document.getElementById('previewPostaGrad').innerHTML = `<strong>Mesto:</strong> ${data.postanskiBroj}, ${data.grad}`;
            document.getElementById('previewPlacanje').innerHTML = `<strong>Plaćanje:</strong> ${this.getPaymentMethodText(data.placanje)}`;
            document.getElementById('previewNapomena').innerHTML = data.napomena ? `<strong>Napomena:</strong> ${data.napomena}` : '<strong>Napomena:</strong> Nema';

            // Stavke Porudžbine (Desna strana)
            const orderItems = document.getElementById('previewOrderItems');
            orderItems.innerHTML = this.cart.map(item => `
                <div class="preview-item">
                    <strong>${item.name} (${item.size}):</strong> ${item.quantity} kom. x ${item.price} RSD = ${item.quantity * item.price} RSD
                </div>
            `).join('');

            // Totali se ažuriraju kroz postojeću metodu
            this.updateCartTotals(true);
        }

        completeOrder() {
            // Logika za slanje emaila (SIMULACIJA)
            console.log("SIMULACIJA SLANJA EMAILA");
            console.log("Podaci o kupcu:", this.checkoutData);
            console.log("Porudžbina:", this.cart);
            
            // Logika za resetovanje stanja
            document.getElementById('confirmationEmail').textContent = this.checkoutData.email;
            this.cart = [];
            this.saveCart();
            this.updateCartCount();
            this.renderCart(); 
            
            // Prelazak na Korak 3
            this.goToStep(3);
        }
        
        saveCart() {
            localStorage.setItem('cart', JSON.stringify(this.cart));
        }

        showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.remove('show');
            void toast.offsetWidth;
            toast.classList.add('show');
            
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        closeModal() {
            document.getElementById('productModal').style.display = 'none';
            document.body.classList.remove('no-scroll');
        }

        toggleCart() {
             document.getElementById('cartSidebar').classList.toggle('active');
             document.body.classList.toggle('no-scroll');
        }

        // ... (Ostale pomoćne funkcije) ...
    }

    // Initialize shop
    const shop = new AresNyXShop();

    // Event listeners
    document.addEventListener('click', (e) => {
        const cartSidebar = document.getElementById('cartSidebar');
        const cartIcon = document.querySelector('.cart-icon');
        const modal = document.getElementById('productModal');

        if (cartSidebar.classList.contains('active') && !cartSidebar.contains(e.target) && !cartIcon.contains(e.target) && !e.target.closest('#checkoutModal')) {
            shop.toggleCart();
        }
        
        if (modal.style.display === 'block' && e.target === modal) {
            shop.closeModal();
        }

        // Dodato: Zatvori Checkout Modal klikom na overlay
        const checkoutModal = document.getElementById('checkoutModal');
        if (checkoutModal.style.display === 'block' && e.target === checkoutModal) {
            shop.closeCheckoutModal();
        }
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            shop.closeModal();
            shop.closeCheckoutModal(); // Zatvori i checkout modal
            document.getElementById('cartSidebar').classList.remove('active');
            document.body.classList.remove('no-scroll');
        }
    });

    // Fallback za font awesome
    if (!window.FontAwesome) {
        const fa = document.createElement('link');
        fa.rel = 'stylesheet';
        fa.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
        document.head.appendChild(fa);
    }
    </script>
</body>
</html>
                                 
