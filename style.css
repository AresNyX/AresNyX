<!DOCTYPE html>
<html lang="sr">
<head>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-63WM74353T"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-63WM74353T');
    </script>
    
    <meta name="google-site-verification" content="AbTZDR5hcpu1fcUcq1wsTOXlimqbvy_-tjSh7IVb-GE" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AresNyX Shop - Premium Boxer Shorts</title>

    <link rel="preload" 
          as="image" 
          href="https://aresnyx.github.io/AresNyX/slike/logo.webp">

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css"> 
    
    <link rel="stylesheet" href="global.css" media="print" onload="this.media='all'">
    
    
    <meta name="description" 
          content="AresNyX Shop - Premium boxer shorts od pamuka, lana i bambusa. 
                   Zdravlje, udobnost i besplatna dostava.">
    <meta name="keywords" 
          content="boxer shorts, donji ve≈°, pamuƒçni gaƒáice, mu≈°ki donji ve≈°, 
                   AresNyX, kupovina, zdravlje, udobnost">
    <meta name="author" content="AresNyX">
    <meta name="robots" content="index, follow">
    
    <meta property="og:title" content="AresNyX Shop - Premium Boxer Shorts">
    <meta property="og:description" 
          content="Premium boxer shorts od prirodnih materijala. 
                   Pamuk, lan i bambus za optimalnu ventilaciju.">
    <meta property="og:image" content="https://aresnyx.github.io/AresNyX/slike/logo.webp">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="https://aresnyx.github.io/AresNyX/shop.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="AresNyX">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="AresNyX Shop - Premium Boxer Shorts">
    <meta name="twitter:description" 
          content="Premium boxer shorts od prirodnih materijala. 
                   Zdravlje i udobnost.">
                   
    </head>
<body>
<header>
    <div class="container">
        <nav>
            <div class="logo">
                <a href=".">AresNyX</a>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Poƒçetna</a></li>
                <li><a href="shop.html" class="active" aria-current="page">Shop</a></li>
                <li><a href="o-nama.html">O Nama</a></li>
                <li><a href="blog-zdravlje-donjeg-vesa.html">Blog</a></li>
                <li><a href="kontakt.html">Kontakt</a></li>
            </ul>
            
            <div class="cart-icon-wrapper" onclick="shop.toggleCart()">
                <span class="cart-icon" aria-label="Korpa"></span> 
                <span id="cartCount">0</span>
            </div>
        </nav>
    </div>
</header>

<main id="main-content" class="shop-main" role="main">
    <div class="container">
        <div class="shop-header">
            <h1>Na≈°a Kompletna Kolekcija</h1>
        </div>

        <button class="filter-toggle-btn" onclick="shop.toggleFilterPanel()" aria-expanded="false" aria-controls="filterSortPanel">
            Filteri i Sortiranje
        </button>

        <div class="filter-sort-bar" id="desktopFilterSortBar">
            
            <div class="sort-group">
                <label for="priceSort">Sortiraj po Ceni:</label>
                <select id="priceSort" onchange="shop.sortProducts(this.value)">
                    <option value="default">Podrazumevano</option>
                    <option value="lowToHigh">Najni≈æa ka najvi≈°oj</option>
                    <option value="highToLow">Najvi≈°a ka najni≈æoj</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="materialFilter">Materijal:</label>
                <select id="materialFilter" onchange="shop.filterProducts(this.value, 'material')">
                    <option value="all">Svi materijali</option>
                    <option value="pamuk">Pamuk</option>
                    <option value="lan">Lan</option>
                    <option value="bambus">Bambus</option>
                    <option value="svila">Svila</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Veliƒçina:</label>
                <div class="size-filter-options" id="sizeFilterOptions">
                    <button class="size-btn" data-size="S" onclick="shop.selectFilterSize(this)">S</button>
                    <button class="size-btn" data-size="M" onclick="shop.selectFilterSize(this)">M</button>
                    <button class="size-btn" data-size="L" onclick="shop.selectFilterSize(this)">L</button>
                    <button class="size-btn" data-size="XL" onclick="shop.selectFilterSize(this)">XL</button>
                    <button class="size-btn" data-size="XXL" onclick="shop.selectFilterSize(this)">XXL</button>
                    <button class="size-btn active" data-size="all" onclick="shop.selectFilterSize(this)">Sve</button>
                </div>  
            </div>
            
            <button class="btn-primary" onclick="shop.applyAllFilters()">Primeni</button>
        </div>

        <div class="modal-backdrop" id="filterSortPanel">
            <div class="modal-content">
                <span class="modal-close" onclick="shop.toggleFilterPanel()">&times;</span>
                <h2>Filteri i Sortiranje</h2>
                <div class="sort-group" style="margin-bottom: 20px;">
                    <label for="priceSortMobile">Sortiraj po Ceni:</label>
                    <select id="priceSortMobile" onchange="shop.sortProducts(this.value)">
                        <option value="default">Podrazumevano</option>
                        <option value="lowToHigh">Najni≈æa ka najvi≈°oj</option>
                        <option value="highToLow">Najvi≈°a ka najni≈æoj</option>
                    </select>
                </div>

                <div class="filter-group" style="margin-bottom: 20px;">
                    <label for="materialFilterMobile">Materijal:</label>
                    <select id="materialFilterMobile" onchange="shop.filterProducts(this.value, 'material')">
                        <option value="all">Svi materijali</option>
                        <option value="pamuk">Pamuk</option>
                        <option value="lan">Lan</option>
                        <option value="bambus">Bambus</option>
                        <option value="svila">Svila</option>
                    </select>
                </div>
                
                <div class="filter-group" style="margin-bottom: 30px;">
                    <label>Veliƒçina:</label>
                    <div class="size-filter-options" id="sizeFilterOptionsMobile">
                        <button class="size-btn" data-size="S" onclick="shop.selectFilterSize(this)">S</button>
                        <button class="size-btn" data-size="M" onclick="shop.selectFilterSize(this)">M</button>
                        <button class="size-btn" data-size="L" onclick="shop.selectFilterSize(this)">L</button>
                        <button class="size-btn" data-size="XL" onclick="shop.selectFilterSize(this)">XL</button>
                        <button class="size-btn" data-size="XXL" onclick="shop.selectFilterSize(this)">XXL</button>
                        <button class="size-btn active" data-size="all" onclick="shop.selectFilterSize(this)">Sve</button>
                    </div>  
                </div>
                
                <button class="btn-primary" onclick="shop.applyAllFilters(); shop.toggleFilterPanel()">Primeni Filter</button>
            </div>
        </div>
        
        <div class="products-grid" id="productsGrid">
            </div>
        
    </div>
</main>

<footer>
    <div class="container">
        <div class="footer-content">
            <div class="footer-logo">ARESNYX</div>
            <p class="footer-tagline">Premium kvalitet. Izuzetan komfor. Va≈° stil.</p>
            
            <div class="footer-links">
                <a href="index.html" class="footer-link">Poƒçetna</a>
                <a href="shop.html" class="footer-link">Shop</a>
                <a href="o-nama.html" class="footer-link">O nama</a>
                <a href="kontakt.html" class="footer-link">Kontakt</a>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 AresNyX. Sva prava zadr≈æana. <a href="politika-privatnosti.html">Politika Privatnosti</a></p>
            </div>
        </div>
    </div>
</footer>

<div class="modal-backdrop" id="productModal" style="display: none;">
    </div>

<div class="cart-sidebar" id="cartSidebar">
    </div>  

<div class="modal-backdrop" id="checkoutModal" style="display: none;">
    </div>

<div id="toast"></div>

<script defer>
    // ... (Ovde ide kompletan kod za ga4UniversalTracker koji ste poslali) ...
    
    // GA4 E-commerce Tracking - UNLIMITED PRODUCTS
    const ga4UniversalTracker = {
        initialized: false,
        
        // ... (Celokupan E-commerce tracking kod ide ovde, preme≈°ten sa vrha) ...

        // SPA≈†AVANJE TRENUTNIH PODATAKA
        productCache: new Map(),  // ID ‚Üí {name, price, material, ...}
        lastSeenProducts: new Set(), // Koje ID-jeve smo videli
        
        init: function() {
            if (this.initialized) return;
            
            console.log('üîç GA4 Universal Tracker starting...');
            
            // 1. Prvo pratimo DOM - NAJVA≈ΩNIJE!
            this.setupDOMMonitoring();
            
            // 2. Pratimo shop objekat ako postoji
            this.setupShopMonitoring();
            
            // 3. Pratimo sve interakcije
            this.setupGlobalEventListeners();
            
            // 4. Pratimo korpu i checkout
            this.setupCartAndCheckoutTracking();
            
            this.initialized = true;
            console.log('‚úÖ GA4 Universal Tracker ready for ANY number of products');
        },
        
        setupDOMMonitoring: function() {
            // OVO JE KLJUƒåNO: pratimo SVE promene u productsGrid
            const productsGrid = document.getElementById('productsGrid');
            if (!productsGrid) {
                console.warn('‚ö†Ô∏è productsGrid not found, retrying in 1s...');
                setTimeout(() => this.setupDOMMonitoring(), 1000);
                return;
            }
            
            console.log('üéØ Monitoring productsGrid for dynamic changes');
            
            // MutationObserver koji detektuje BILO KAKVE promene
            const observer = new MutationObserver((mutations) => {
                let newProductsDetected = false;
                
                mutations.forEach((mutation) => {
                    // Detektuj nove ƒçvorove
                    if (mutation.addedNodes.length) {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeType === 1) {
                                if (this.isProductCard(node)) {
                                    this.processProductCard(node);
                                    newProductsDetected = true;
                                }
                            }
                        });
                    }
                    
                    // Detektuj promene u postojeƒáim ƒçvorovima
                    if (mutation.type === 'attributes') {
                        const card = mutation.target;
                        if (this.isProductCard(card)) {
                            this.updateProductFromCard(card);
                        }
                    }
                });
                
                // Ako ima novih proizvoda, po≈°alji view_item_list
                if (newProductsDetected) {
                    setTimeout(() => this.trackCurrentProductList(), 500);
                }
            });
            
            // Pratimo SVE: nove elemente, atribute, tekst
            observer.observe(productsGrid, {
                childList: true,     // Novi elementi
                subtree: true,       // Sve unutar grid-a
                attributes: true,    // Promene atributa
                attributeFilter: ['data-product-id', 'class', 'id'] // Koje atribute pratimo
            });
            
            // Obrati pa≈ænju i na postojeƒáe kartice
            setTimeout(() => {
                document.querySelectorAll('.product-card, [data-product-id]').forEach(card => {
                    this.processProductCard(card);
                });
                
                // Po≈°alji inicijalni view_item_list
                this.trackCurrentProductList();
            }, 1500);
        },
        
        isProductCard: function(element) {
            // Proverava da li je element product kartica na BILO KOJI naƒçin
            return element.classList?.contains('product-card') ||
                   element.hasAttribute('data-product-id') ||
                   element.classList?.contains('product-item') ||
                   element.querySelector('.product-title, .product-name, [data-price]') !== null ||
                   element.textContent?.match(/\d{3,}\s*RSD/) !== null; // Ima cenu u RSD
        },
        
        processProductCard: function(card) {
            // 1. Pronaƒëi ID
            const productId = this.extractProductId(card);
            if (!productId) {
                console.log('üìå Card without ID, generating one:', card);
                return;
            }
            
            // 2. Ekstraktuj podatke
            const productData = this.extractProductData(card, productId);
            
            // 3. Saƒçuvaj u ke≈°
            this.productCache.set(productId, productData);
            this.lastSeenProducts.add(productId);
            
            // 4. Postavi event listenere
            this.attachCardEventListeners(card, productId, productData);
            
            console.log(`üì¶ Processed product ${productId}: ${productData.name}`);
        },
        
        extractProductId: function(card) {
            // Poku≈°aj na 5 razliƒçitih naƒçina da pronaƒëe≈° ID
            const idSources = [
                () => card.getAttribute('data-product-id'),
                () => card.id?.match(/product[-_]?(\d+)/i)?.[1],
                () => card.getAttribute('id')?.replace(/^product[-_]?/i, ''),
                () => card.closest('[data-product-id]')?.getAttribute('data-product-id'),
                () => {
                    // Generi≈°i ID na osnovu pozicije/sadr≈æaja
                    const name = card.querySelector('h3, .product-title')?.textContent;
                    if (name) {
                        return 'prod_' + name.toLowerCase().replace(/\s+/g, '_').substring(0, 20);
                    }
                    return 'prod_' + Math.random().toString(36).substring(2, 10);
                }
            ];
            
            for (const source of idSources) {
                const id = source();
                if (id && id.trim() !== '') {
                    return id.toString().trim();
                }
            }
            
            return null;
        },
        
        extractProductData: function(card, productId) {
            // Dinamiƒçko ƒçitanje SVIH podataka iz HTML-a
            const titleElem = card.querySelector('h3, .product-title, .product-name, [data-product-name]');
            const priceElem = card.querySelector('.product-price, .price, [data-price], .cost');
            const materialElem = card.querySelector('.product-material, .material, [data-material], .fabric');
            const badgeElem = card.querySelector('.product-badge, .badge, [data-badge], .tag');
            
            // Ekstraktuj cenu
            let price = 0;
            if (priceElem) {
                const priceText = priceElem.textContent;
                const match = priceText.match(/(\d{1,3}(?:[.,]\d{3})*(?:[.,]\d{2})?)/);
                if (match) {
                    price = parseFloat(match[1].replace(/\./g, '').replace(',', '.'));
                }
            }
            
            return {
                id: productId,
                name: titleElem?.textContent.trim() || `Product ${productId}`,
                material: materialElem?.textContent.trim() || this.guessMaterial(card),
                price: price,
                category: 'Donji ve≈°',
                badge: badgeElem?.textContent.trim() || 'STANDARD',
                currency: 'RSD',
                brand: 'AresNyX',
                // Dodatni podaci ako postoje
                sizes: this.extractSizes(card),
                image: card.querySelector('img')?.src || ''
            };
        },
        
        guessMaterial: function(card) {
            const text = card.textContent.toLowerCase();
            const materials = {
                'pamuk': 'Pamuk',
                'lan': 'Lan',
                'bambus': 'Bambus',
                'svila': 'Svila',
                'pima': 'Pima Pamuk',
                'egipat': 'Egipatski Pamuk',
                'organski': 'Organski Pamuk'
            };
            
            for (const [key, value] of Object.entries(materials)) {
                if (text.includes(key)) return value;
            }
            
            return 'Standard';
        },
        
        extractSizes: function(card) {
            const sizeElements = card.querySelectorAll('.size-tag, .size-badge, [data-size]');
            if (sizeElements.length > 0) {
                return Array.from(sizeElements).map(el => el.textContent.trim()).join(', ');
            }
            return 'M,L,XL,XXL';
        },
        
        attachCardEventListeners: function(card, productId, productData) {
            // Klik na celu karticu (osim dugmadi)
            card.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                    return;
                }
                
                this.trackProductClick(productData);
            });
            
            // Klik na bilo koje dugme za detalje
            const detailButtons = card.querySelectorAll('button, a, [onclick*="openModal"], [onclick*="viewDetails"]');
            detailButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    this.trackProductClick(productData);
                });
            });
        },
        
        updateProductFromCard: function(card) {
            const productId = this.extractProductId(card);
            if (!productId) return;
            
            const updatedData = this.extractProductData(card, productId);
            this.productCache.set(productId, updatedData);
            
            console.log(`üîÑ Updated product ${productId}: ${updatedData.name}`);
        },
        
        trackCurrentProductList: function() {
            if (typeof gtag !== 'function') return;
            
            const products = Array.from(this.productCache.values());
            if (products.length === 0) return;
            
            gtag('event', 'view_item_list', {
                items: products.map(product => ({
                    item_id: product.id,
                    item_name: product.name,
                    item_category: product.category,
                    item_variant: product.material,
                    price: product.price,
                    currency: product.currency,
                    item_brand: product.brand,
                    item_badge: product.badge,
                    available_sizes: product.sizes
                })),
                item_list_name: 'AresNyX Collection',
                item_list_id: 'dynamic_grid'
            });
            
            console.log(`üìä Sent view_item_list with ${products.length} products`);
        },
        
        setupShopMonitoring: function() {
            // Pratimo shop objekat ako postoji, ali ne zavistimo od njega
            if (window.shop && window.shop.products) {
                console.log('üè™ Shop object detected, syncing with DOM...');
                this.syncWithShopProducts(window.shop.products);
            }
            
            // Pratimo da li se shop objekat pojavi kasnije
            let attempts = 0;
            const shopWatcher = setInterval(() => {
                if (window.shop && window.shop.products) {
                    clearInterval(shopWatcher);
                    this.syncWithShopProducts(window.shop.products);
                } else if (attempts > 10) {
                    clearInterval(shopWatcher);
                }
                attempts++;
            }, 500);
        },
        
        syncWithShopProducts: function(shopProducts) {
            shopProducts.forEach(shopProduct => {
                const productId = shopProduct.id.toString();
                if (!this.productCache.has(productId)) {
                    this.productCache.set(productId, {
                        id: productId,
                        name: shopProduct.name,
                        material: shopProduct.material,
                        price: shopProduct.price,
                        category: shopProduct.category || 'Donji ve≈°',
                        badge: shopProduct.badge || 'STANDARD',
                        currency: 'RSD',
                        brand: 'AresNyX',
                        sizes: shopProduct.sizes ? Object.keys(shopProduct.sizes).join(',') : 'M,L,XL,XXL'
                    });
                }
            });
            
            console.log(`üîÑ Synced ${shopProducts.length} products from shop object`);
        },
        
        setupGlobalEventListeners: function() {
            // Pratimo modale
            this.setupModalTracking();
            
            // Pratimo sve add_to_cart evente
            document.addEventListener('click', (e) => {
                const addToCartBtn = e.target.closest('.add-to-cart-btn, [onclick*="addToCart"], button:contains("Dodaj")');
                if (addToCartBtn) {
                    setTimeout(() => this.trackAddToCartEvent(), 100);
                }
            });
        },
        
        setupModalTracking: function() {
            // Pratimo otvaranje modala
            const modal = document.getElementById('productModal');
            if (modal) {
                const modalObserver = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.attributeName === 'style' && modal.style.display !== 'none') {
                            setTimeout(() => this.trackModalProductView(), 200);
                        }
                    });
                });
                
                modalObserver.observe(modal, { attributes: true });
            }
        },
        
        trackModalProductView: function() {
            const modalTitle = document.getElementById('modalTitle');
            const modalPrice = document.getElementById('modalPrice');
            
            if (!modalTitle || !modalPrice) return;
            
            const productName = modalTitle.textContent.trim();
            const price = this.extractPriceFromText(modalPrice.textContent);
            
            // Pronaƒëi productId iz modala ili ke≈°a
            let productId = document.querySelector('.size-btn.selected')?.getAttribute('data-product-id') ||
                           this.findProductIdByName(productName);
            
            if (!productId) productId = 'modal_' + productName.replace(/\s+/g, '_');
            
            const productData = {
                id: productId,
                name: productName,
                price: price,
                material: document.getElementById('modalMaterial')?.textContent.trim() || 'Standard',
                currency: 'RSD',
                category: 'Donji ve≈°',
                brand: 'AresNyX'
            };
            
            this.trackProductView(productData);
        },
        
        findProductIdByName: function(productName) {
            for (const [id, product] of this.productCache) {
                if (product.name === productName) {
                    return id;
                }
            }
            return null;
        },
        
        extractPriceFromText: function(text) {
            let price = 0;
            if (text) {
                const match = text.match(/(\d{1,3}(?:[.,]\d{3})*(?:[.,]\d{2})?)/);
                if (match) {
                    price = parseFloat(match[1].replace(/\./g, '').replace(',', '.'));
                }
            }
            return price;
        },
        
        trackAddToCartEvent: function() {
            // Ova funkcija se poziva nakon add_to_cart
            // Mo≈æe≈° je pozvati iz tvoje shop.addToCart funkcije
            console.log('üõí Add to cart event detected');
        },
        
        setupCartAndCheckoutTracking: function() {
            // Ovo ostaje isto kao prethodni kod
            // view_cart, begin_checkout, purchase
        },
        
        // ========== GA4 EVENT FUNKCIJE ==========
        trackProductClick: function(product) {
            if (!product || typeof gtag !== 'function') return;
            
            gtag('event', 'select_item', {
                items: [{
                    item_id: product.id,
                    item_name: product.name,
                    item_category: product.category,
                    item_variant: product.material,
                    price: product.price,
                    currency: product.currency,
                    item_brand: product.brand,
                    item_list_name: 'AresNyX Collection'
                }]
            });
            
            console.log(`üñ±Ô∏è Tracked click: ${product.name}`);
        },
        
        trackProductView: function(product) {
            if (!product || typeof gtag !== 'function') return;
            
            gtag('event', 'view_item', {
                currency: product.currency,
                value: product.price,
                items: [{
                    item_id: product.id,
                    item_name: product.name,
                    item_category: product.category,
                    item_variant: product.material,
                    price: product.price,
                    item_brand: product.brand
                }]
            });
            
            console.log(`üëÅÔ∏è Tracked view: ${product.name} (${product.price} ${product.currency})`);
        }
    };

    // Pokreni odmah
    document.addEventListener('DOMContentLoaded', function() {
        ga4UniversalTracker.init();
    });

    // Pokreni i ako se DOM uƒçita kasnije (SPA)
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
        ga4UniversalTracker.init();
    }
</script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js" defer></script>
    <script src="script.js" defer></script> 
    
</body>
</html>


